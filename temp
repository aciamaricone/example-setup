Call IP gcloud to get ip addres for static IP
Need the startup script for the bastion host (for assignment of the static IP)
https://aws.amazon.com/quickstart/architecture/linux-bastion/
https://docs.aws.amazon.com/quickstart/latest/linux-bastion/welcome.html 

##### https://stackoverflow.com/questions/58138006/how-to-reuse-static-ip-address-on-google-cloud-compute-engine-from-command-line

gcloud compute instance-templates create $CLIENT_1_INSTANCE_TEMPLATE \
--machine-type=n2-standard-2 \
--subnet=projects/$HUB_PROJECT/regions/$REGION/subnetworks/$CLIENT_1_PROJECT_SUBNET \
--no-address \
--maintenance-policy=MIGRATE \
--service-account=$CLIENT_1_COMPUTE_SA \
--scopes=https://www.googleapis.com/auth/devstorage.read_only,https://www.googleapis.com/auth/logging.write,https://www.googleapis.com/auth/monitoring.write,https://www.googleapis.com/auth/servicecontrol,https://www.googleapis.com/auth/service.management.readonly,https://www.googleapis.com/auth/trace.append \
--region=$USC_REGION \
--tags=gcp-bastion \
--image=centos-7-v20200714 \
--image-project=centos-cloud \
--boot-disk-size=20GB \
--boot-disk-type=pd-standard \
--boot-disk-device-name=$CLIENT_1_INSTANCE_TEMPLATE \
--shielded-secure-boot \
--shielded-vtpm \
--shielded-integrity-monitoring \
--reservation-affinity=any


gcloud compute health-checks create tcp $CLIENT_1_MIG_HEALTHCHECK \
--global \
--timeout "5" \
--check-interval "10" \
--unhealthy-threshold "3" \
--healthy-threshold "2" \
--port "80"

gcloud compute instance-groups managed create $CLIENT_1_INSTANCE_GROUP \
--template=$CLIENT_1_INSTANCE_TEMPLATE \
--zones=us-central1-b,us-central1-c \
--size=1 \
--instance-redistribution-type=PROACTIVE \
--health-check=$CLIENT_1_MIG_HEALTHCHECK \
--initial-delay=300

gcloud compute instance-groups managed set-autoscaling $CLIENT_1_INSTANCE_GROUP \
--region=$REGION \
--cool-down-period "60" \
--max-num-replicas "1" \
--min-num-replicas "1" \
--target-cpu-utilization "0.9" \
--mode "on"

gcloud compute health-checks create tcp $CLIENT_1_LB_HEALTHCHECK \
--global \
--timeout "5" \
--check-interval "10" \
--unhealthy-threshold "3" \
--healthy-threshold "2" \
--port "80"

gcloud compute backend-services create $CLIENT_1_BACKEND \
--protocol TCP \
--global \
--health-checks $CLIENT_1_LB_HEALTHCHECK

gcloud compute backend-services add-backend $CLIENT_1_BACKEND \
--global \
--instance-group $CLIENT_1_INSTANCE_GROUP \
--instance-group-region=$REGION \
--balancing-mode UTILIZATION \
--max-utilization 0.8

gcloud compute addresses create $CLIENT_1_BASTION_IP \
--global \
--ip-version=IPV4

gcloud compute forwarding-rules create $CLIENT_1_FORWARD_RULE_1 \
--global \
--address=$CLIENT_1_BASTION_IP \
--ports=22




DOMAIN=acxiom.com
SHARED_SERVICES_FOLDER=shared_services
CLIENT_1_FOLDER=client_1
CLIENT_2_FOLDER=client_2
USER1=blake.reed@acxiom.com
BILLING_ID=0111B9-D0C0B2-04DD65


CLIENT_1_INSTANCE_TEMPLATE="$CLIENT_1_PROJECT"-instance-template
CLIENT_2_INSTANCE_TEMPLATE="$CLIENT_2_PROJECT"-instance-template
CLIENT_1_INSTANCE_GROUP="$CLIENT_1_PROJECT"-mig
CLIENT_2_INSTANCE_GROUP="$CLIENT_2_PROJECT"-mig
CLIENT_1_MIG_HEALTHCHECK="$CLIENT_1_INSTANCE_GROUP"-healtcheck
CLIENT_2_MIG_HEALTHCHECK="$CLIENT_2_INSTANCE_GROUP"-healtcheck
CLIENT_1_LB="$CLIENT_1_PROJECT"-lb
CLIENT_2_LB="$CLIENT_1_PROJECT"-lb
CLIENT_1_LB_HEALTHCHECK="$CLIENT_1_LB"-healtcheck
CLIENT_2_LB_HEALTHCHECK="$CLIENT_1_LB"-healtcheck
CLIENT_1_BACKEND="$CLIENT_1_PROJECT"-backend
CLIENT_2_BACKEND="$CLIENT_1_PROJECT"-backend
CLIENT_1_FORWARD_RULE_1="$CLIENT_1_PROJECT"-forwarding-rule-1
CLIENT_1_FORWARD_RULE_2="$CLIENT_1_PROJECT"-forwarding-rule-2
CLIENT_2_FORWARD_RULE_1="$CLIENT_2_PROJECT"-forwarding-rule-1
CLIENT_2_FORWARD_RULE_2="$CLIENT_2_PROJECT"-forwarding-rule-2

# Store organization ID for use in folder creation
ORG_ID=`gcloud organizations list | grep $DOMAIN | awk '{print $2}'`

# Create Folders and store IDs
# https://cloud.google.com/sdk/gcloud/reference/alpha/resource-manager/folders/list
gcloud alpha resource-manager folders create \
--display-name=$SHARED_SERVICES_FOLDER \
--organization=$ORG_ID
SHARED_SERVICES_FOLDER_ID=`gcloud alpha resource-manager folders list --organization=$ORG_ID | grep $SHARED_SERVICES_FOLDER | awk '{print $3}'`

gcloud alpha resource-manager folders create \
--display-name=$CLIENT_1_FOLDER \
--organization=$ORG_ID
CLIENT_1_FOLDER_ID=`gcloud alpha resource-manager folders list --organization=$ORG_ID | grep $CLIENT_1_PROJECT | awk '{print $3}'`

gcloud alpha resource-manager folders create \
--display-name=$CLIENT_2_FOLDER \
--organization=$ORG_ID
CLIENT_2_FOLDER_ID=`gcloud alpha resource-manager folders list --organization=$ORG_ID | grep $CLIENT_2_PROJECT | awk '{print $3}'`

# Create Projects
# https://cloud.google.com/sdk/gcloud/reference/projects/create
gcloud projects create $HUB_PROJECT \
--folder=$SHARED_SERVICES_FOLDER_ID
gcloud beta billing projects link $HUB_PROJECT --billing-account=$BILLING_ID
HUB_PROJECT_ID=`gcloud projects list | grep $HUB_PROJECT | awk '{print $3}'`

gcloud projects create $CLIENT_1_PROJECT \
--folder=$CLIENT_1_FOLDER_ID
gcloud beta billing projects link $CLIENT_1_PROJECT --billing-account=$BILLING_ID
CLIENT_1_PROJECT_ID=`gcloud projects list | grep $CLIENT_1_PROJECT | awk '{print $3}'`

gcloud projects create $CLIENT_2_PROJECT \
--folder=$CLIENT_2_FOLDER_ID
gcloud beta billing projects link $CLIENT_2_PROJECT --billing-account=$BILLING_ID
CLIENT_2_PROJECT_ID=`gcloud projects list | grep $CLIENT_2_PROJECT | awk '{print $3}'`

# Assign Project Owner roles in order to enable ease of use for evaluation
# https://cloud.google.com/sdk/gcloud/reference/projects/add-iam-policy-binding
gcloud projects add-iam-policy-binding $HUB_PROJECT_ID \
--member=user:$USER1 \
--role=roles/owner

gcloud projects add-iam-policy-binding $CLIENT_1_PROJECT_ID \
--member=user:$USER1 \
--role=roles/owner

gcloud projects add-iam-policy-binding $CLIENT_2_PROJECT_ID \
--member=user:$USER1 \
--role=roles/owner